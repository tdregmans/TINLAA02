<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.6//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_6.dtd'>
<nta>
	<declaration>
// sluisdeuren
const int AANTAL_SLUISDEUREN = 2;
typedef int[0,AANTAL_SLUISDEUREN - 1] sluisdeur_id;

chan openDeur[sluisdeur_id];
chan sluitDeur[sluisdeur_id];
chan deurGeopend[sluisdeur_id];
chan deurGesloten[sluisdeur_id];

// scheepssensoren
const int AANTAL_SCHEEPSSENSOREN = 3;
typedef int[0,AANTAL_SCHEEPSSENSOREN - 1] schipsensor_id;

chan schipGedetecteerd[schipsensor_id];

// vaarseinen
const int AANTAL_VAARSEINEN = 4;
typedef int[0,AANTAL_VAARSEINEN - 1] vaarsein_id;

chan zetSeinOpGroen[vaarsein_id];
chan zetSeinOpRood[vaarsein_id];

// sluisluiken
const int AANTAL_SLUISLUIKEN = 2;
typedef int[0,AANTAL_SLUISLUIKEN - 1] sluisluik_id;

chan openLuik[sluisluik_id];
chan sluitLuik[sluisluik_id];


// constanten ter verduidelijking
const int LAAG = 0;
const int HOOG = 1;

const int BINNEN = 2;
const int BUITEN = 0;

// vaarsein_id 0: (LAAG + BINNEN)
// vaarsein_id 1: (LAAG + BUITEN)
// vaarsein_id 2: (HOOG + BINNEN)
// vaarsein_id 3: (HOOG + BUITEN)

// BINNEN=2 maakt het mogelijk om BINNEN ook te gebruiken voor scheepssensor(BINNEN)

// constante tijdsduur waterbeweging en deurbeweging
const int DELAY_WATERBEWEGING = 10;
const int DELAY_DEURBEWEGING = 5;</declaration>
	<template>
		<name>vaarsein</name>
		<parameter>vaarsein_id i</parameter>
		<location id="id0" x="0" y="0">
			<name x="-42" y="-34">rood</name>
		</location>
		<location id="id1" x="136" y="0">
			<name x="144" y="-34">groen</name>
		</location>
		<init ref="id0"/>
		<transition id="id2">
			<source ref="id1"/>
			<target ref="id0"/>
			<label kind="synchronisation" x="0" y="76">zetSeinOpRood[i]?</label>
			<nail x="102" y="68"/>
			<nail x="34" y="68"/>
		</transition>
		<transition id="id3">
			<source ref="id0"/>
			<target ref="id1"/>
			<label kind="synchronisation" x="-8" y="-93">zetSeinOpGroen[i]?</label>
			<nail x="34" y="-68"/>
			<nail x="102" y="-68"/>
		</transition>
	</template>
	<template>
		<name x="5" y="5">sluis</name>
		<declaration>clock x;

bool reverse = false;

int[LAAG,HOOG] waterniveau = LAAG;</declaration>
		<location id="id4" x="204" y="102">
			<name x="221" y="119">start</name>
			<label kind="comments" x="229" y="144">Alles gesloten,
waterniveau = LAAG
en seinen op rood.</label>
		</location>
		<location id="id5" x="442" y="-136">
			<name x="450" y="-178">deurLaagOpenend</name>
		</location>
		<location id="id6" x="680" y="102">
			<name x="688" y="68">klaarVoorSchipLaag</name>
		</location>
		<location id="id7" x="680" y="340">
			<name x="697" y="331">deurLaagSluitend</name>
		</location>
		<location id="id8" x="680" y="578">
			<name x="680" y="595">klaarVoorBeweging</name>
		</location>
		<location id="id9" x="204" y="748">
			<name x="204" y="790">sluiswaterInBeweging</name>
			<label kind="invariant" x="204" y="807">x&lt;=DELAY_WATERBEWEGING</label>
		</location>
		<location id="id10" x="-272" y="578">
			<name x="-416" y="595">klaarMetBeweging</name>
		</location>
		<location id="id11" x="-272" y="340">
			<name x="-408" y="306">deurHoogOpenend</name>
		</location>
		<location id="id12" x="-272" y="102">
			<name x="-433" y="68">klaarVoorSchipHoog</name>
		</location>
		<location id="id13" x="-34" y="-136">
			<name x="-178" y="-178">deurHoogSluitend</name>
		</location>
		<location id="id14" x="255" y="-17">
			<label kind="invariant" x="246" y="42">x&lt;=0</label>
		</location>
		<location id="id15" x="0" y="102">
			<label kind="invariant" x="17" y="68">x&lt;=0</label>
		</location>
		<location id="id16" x="-102" y="748">
			<name x="-102" y="790">luikSluiten</name>
			<committed/>
		</location>
		<location id="id17" x="510" y="748">
			<name x="518" y="790">luikOpenen</name>
			<committed/>
		</location>
		<location id="id18" x="680" y="170">
			<name x="697" y="161">invaarseinOpGroen</name>
		</location>
		<location id="id19" x="680" y="272">
			<name x="697" y="263">sluitDeurLaag</name>
			<committed/>
		</location>
		<location id="id20" x="680" y="238">
			<name x="697" y="229">invaarseinOpRood</name>
			<committed/>
		</location>
		<init ref="id4"/>
		<transition id="id21">
			<source ref="id18"/>
			<target ref="id20"/>
			<label kind="synchronisation" x="688" y="195">schipGedetecteerd[BINNEN]?</label>
		</transition>
		<transition id="id22">
			<source ref="id20"/>
			<target ref="id19"/>
			<label kind="synchronisation" x="688" y="246">zetSeinOpRood[LAAG + BUITEN]!</label>
		</transition>
		<transition id="id23">
			<source ref="id6"/>
			<target ref="id18"/>
			<label kind="guard" x="688" y="110">reverse==false</label>
			<label kind="synchronisation" x="688" y="127">zetSeinOpGroen[LAAG + BUITEN]!</label>
		</transition>
		<transition id="id24">
			<source ref="id4"/>
			<target ref="id10"/>
			<label kind="guard" x="34" y="331">waterniveau==HOOG</label>
			<label kind="synchronisation" x="-17" y="348">schipGedetecteerd[LAAG]?</label>
			<label kind="assignment" x="144" y="314">x=0</label>
			<nail x="170" y="544"/>
			<nail x="-204" y="544"/>
		</transition>
		<transition id="id25">
			<source ref="id9"/>
			<target ref="id17"/>
			<label kind="guard" x="306" y="654">reverse==true</label>
			<label kind="synchronisation" x="306" y="637">sluitLuik[LAAG]!</label>
			<label kind="assignment" x="306" y="680">x=0</label>
			<nail x="238" y="680"/>
			<nail x="476" y="680"/>
		</transition>
		<transition id="id26">
			<source ref="id16"/>
			<target ref="id9"/>
			<label kind="guard" x="0" y="654">reverse==true</label>
			<label kind="synchronisation" x="0" y="637">openLuik[LAAG]!</label>
			<label kind="assignment" x="0" y="680">waterniveau=LAAG</label>
			<nail x="-68" y="680"/>
			<nail x="170" y="680"/>
		</transition>
		<transition id="id27">
			<source ref="id9"/>
			<target ref="id16"/>
			<label kind="guard" x="0" y="765">reverse==false</label>
			<label kind="synchronisation" x="0" y="748">sluitLuik[HOOG]!</label>
			<label kind="assignment" x="0" y="722">x=0</label>
		</transition>
		<transition id="id28">
			<source ref="id17"/>
			<target ref="id9"/>
			<label kind="guard" x="306" y="765">reverse==false</label>
			<label kind="synchronisation" x="306" y="748">openLuik[HOOG]!</label>
			<label kind="assignment" x="306" y="731">waterniveau=HOOG</label>
		</transition>
		<transition id="id29">
			<source ref="id4"/>
			<target ref="id14"/>
			<label kind="guard" x="246" y="0">waterniveau==LAAG</label>
			<label kind="synchronisation" x="204" y="17">schipGedetecteerd[LAAG]?</label>
			<label kind="assignment" x="246" y="25">x=0</label>
		</transition>
		<transition id="id30">
			<source ref="id4"/>
			<target ref="id15"/>
			<label kind="guard" x="34" y="119">waterniveau==HOOG</label>
			<label kind="synchronisation" x="-8" y="136">schipGedetecteerd[HOOG]?</label>
			<label kind="assignment" x="34" y="102">x=0</label>
		</transition>
		<transition id="id31">
			<source ref="id17"/>
			<target ref="id8"/>
			<label kind="guard" x="416" y="586">reverse==true</label>
			<nail x="544" y="578"/>
		</transition>
		<transition id="id32">
			<source ref="id10"/>
			<target ref="id16"/>
			<label kind="guard" x="-119" y="603">reverse==true</label>
			<label kind="assignment" x="-119" y="586">x=0</label>
			<nail x="-136" y="578"/>
		</transition>
		<transition id="id33">
			<source ref="id8"/>
			<target ref="id7"/>
			<label kind="guard" x="493" y="442">reverse==true</label>
			<label kind="synchronisation" x="476" y="425">openDeur[LAAG]!</label>
			<nail x="612" y="476"/>
			<nail x="612" y="374"/>
		</transition>
		<transition id="id34">
			<source ref="id11"/>
			<target ref="id10"/>
			<label kind="guard" x="-195" y="442">reverse==true</label>
			<label kind="synchronisation" x="-195" y="425">deurGesloten[HOOG]?</label>
			<nail x="-204" y="374"/>
			<nail x="-204" y="476"/>
		</transition>
		<transition id="id35">
			<source ref="id7"/>
			<target ref="id6"/>
			<label kind="guard" x="493" y="204">reverse==true</label>
			<label kind="synchronisation" x="450" y="187">deurGeopend[LAAG]?</label>
			<nail x="612" y="306"/>
			<nail x="612" y="136"/>
		</transition>
		<transition id="id36">
			<source ref="id12"/>
			<target ref="id11"/>
			<label kind="guard" x="-195" y="204">reverse==true</label>
			<label kind="synchronisation" x="-195" y="187">sluitDeur[HOOG]!</label>
			<nail x="-204" y="136"/>
			<nail x="-204" y="306"/>
		</transition>
		<transition id="id37">
			<source ref="id6"/>
			<target ref="id5"/>
			<label kind="guard" x="484" y="102">reverse==true</label>
			<label kind="synchronisation" x="484" y="76">sluitDeur[LAAG]!</label>
			<nail x="476" y="102"/>
			<nail x="476" y="-102"/>
		</transition>
		<transition id="id38">
			<source ref="id13"/>
			<target ref="id12"/>
			<label kind="guard" x="-187" y="102">reverse==true</label>
			<label kind="synchronisation" x="-229" y="76">deurGeopend[HOOG]?</label>
			<nail x="-68" y="-102"/>
			<nail x="-68" y="102"/>
		</transition>
		<transition id="id39">
			<source ref="id5"/>
			<target ref="id4"/>
			<label kind="guard" x="289" y="102">reverse==true</label>
			<label kind="synchronisation" x="238" y="76">deurGesloten[LAAG]?</label>
			<nail x="408" y="-102"/>
			<nail x="408" y="102"/>
		</transition>
		<transition id="id40">
			<source ref="id15"/>
			<target ref="id13"/>
			<label kind="synchronisation" x="8" y="-17">openDeur[HOOG]!</label>
			<label kind="assignment" x="8" y="0">reverse=true</label>
			<nail x="0" y="-102"/>
		</transition>
		<transition id="id41">
			<source ref="id13"/>
			<target ref="id4"/>
			<label kind="guard" x="-8" y="-136">reverse==false</label>
			<label kind="synchronisation" x="-8" y="-161">deurGesloten[HOOG]?</label>
			<nail x="102" y="-136"/>
		</transition>
		<transition id="id42">
			<source ref="id12"/>
			<target ref="id13"/>
			<label kind="guard" x="-374" y="-68">reverse==false</label>
			<label kind="synchronisation" x="-391" y="-93">sluitDeur[HOOG]!</label>
			<nail x="-238" y="-136"/>
		</transition>
		<transition id="id43">
			<source ref="id11"/>
			<target ref="id12"/>
			<label kind="guard" x="-399" y="204">reverse==false</label>
			<label kind="synchronisation" x="-433" y="187">deurGeopend[HOOG]?</label>
		</transition>
		<transition id="id44">
			<source ref="id10"/>
			<target ref="id11"/>
			<label kind="guard" x="-399" y="442">reverse==false</label>
			<label kind="synchronisation" x="-408" y="425">openDeur[HOOG]!</label>
		</transition>
		<transition id="id45">
			<source ref="id16"/>
			<target ref="id10"/>
			<label kind="guard" x="-382" y="680">reverse==false</label>
			<nail x="-238" y="748"/>
		</transition>
		<transition id="id46">
			<source ref="id8"/>
			<target ref="id17"/>
			<label kind="guard" x="663" y="714">reverse==false</label>
			<label kind="assignment" x="663" y="697">x=0</label>
			<nail x="646" y="748"/>
		</transition>
		<transition id="id47">
			<source ref="id7"/>
			<target ref="id8"/>
			<label kind="guard" x="688" y="442">reverse==false</label>
			<label kind="synchronisation" x="688" y="425">deurGesloten[LAAG]?</label>
		</transition>
		<transition id="id48">
			<source ref="id19"/>
			<target ref="id7"/>
			<label kind="synchronisation" x="688" y="289">sluitDeur[LAAG]!</label>
		</transition>
		<transition id="id49">
			<source ref="id5"/>
			<target ref="id6"/>
			<label kind="guard" x="663" y="-68">reverse==false</label>
			<label kind="synchronisation" x="663" y="-93">deurGeopend[LAAG]?</label>
			<nail x="646" y="-136"/>
		</transition>
		<transition id="id50">
			<source ref="id14"/>
			<target ref="id5"/>
			<label kind="synchronisation" x="306" y="-161">openDeur[LAAG]!</label>
			<label kind="assignment" x="306" y="-136">reverse=false,
x=0</label>
			<nail x="306" y="-136"/>
		</transition>
		<transition id="id51">
			<source ref="id4"/>
			<target ref="id8"/>
			<label kind="guard" x="238" y="331">waterniveau==LAAG</label>
			<label kind="synchronisation" x="238" y="348">schipGedetecteerd[HOOG]?</label>
			<label kind="assignment" x="238" y="314">x=0</label>
			<nail x="238" y="544"/>
			<nail x="612" y="544"/>
		</transition>
	</template>
	<template>
		<name>schipsensor</name>
		<parameter>schipsensor_id i</parameter>
		<declaration>clock x;</declaration>
		<location id="id52" x="0" y="0">
			<name x="-59" y="-34">sensor</name>
		</location>
		<init ref="id52"/>
		<transition id="id53">
			<source ref="id52"/>
			<target ref="id52"/>
			<label kind="guard" x="76" y="8">x&gt;=1</label>
			<label kind="synchronisation" x="76" y="-25">schipGedetecteerd[i]!</label>
			<label kind="assignment" x="76" y="-8">x=0</label>
			<nail x="68" y="-68"/>
			<nail x="68" y="68"/>
		</transition>
	</template>
	<template>
		<name>sluisluik</name>
		<parameter>sluisluik_id i</parameter>
		<location id="id54" x="0" y="0">
			<name x="-85" y="-34">gesloten</name>
		</location>
		<location id="id55" x="170" y="0">
			<name x="178" y="-34">geopend</name>
		</location>
		<init ref="id54"/>
		<transition id="id56">
			<source ref="id55"/>
			<target ref="id54"/>
			<label kind="synchronisation" x="34" y="76">sluitLuik[i]?</label>
			<nail x="136" y="68"/>
			<nail x="34" y="68"/>
		</transition>
		<transition id="id57">
			<source ref="id54"/>
			<target ref="id55"/>
			<label kind="synchronisation" x="34" y="-93">openLuik[i]?</label>
			<nail x="34" y="-68"/>
			<nail x="136" y="-68"/>
		</transition>
	</template>
	<template>
		<name>sluisdeur</name>
		<parameter>sluisdeur_id i</parameter>
		<declaration>clock x;</declaration>
		<location id="id58" x="-272" y="-170">
			<name x="-263" y="-204">gesloten</name>
		</location>
		<location id="id59" x="102" y="-170">
			<name x="102" y="-204">open</name>
		</location>
		<location id="id60" x="-68" y="-340">
			<name x="-59" y="-382">aanHetOpenen</name>
			<label kind="invariant" x="-59" y="-365">x&lt;=DELAY_DEURBEWEGING</label>
		</location>
		<location id="id61" x="-68" y="0">
			<name x="-59" y="8">aanHetSluiten</name>
			<label kind="invariant" x="-59" y="25">x&lt;=DELAY_DEURBEWEGING</label>
		</location>
		<init ref="id58"/>
		<transition id="id62">
			<source ref="id61"/>
			<target ref="id58"/>
			<label kind="guard" x="-246" y="-68">x&gt;=DELAY_DEURBEWEGING</label>
			<label kind="synchronisation" x="-246" y="-85">deurGesloten[i]!</label>
			<nail x="-238" y="0"/>
		</transition>
		<transition id="id63">
			<source ref="id59"/>
			<target ref="id61"/>
			<label kind="synchronisation" x="93" y="-85">sluitDeur[i]?</label>
			<label kind="assignment" x="93" y="-68">x=0</label>
			<nail x="68" y="0"/>
		</transition>
		<transition id="id64">
			<source ref="id60"/>
			<target ref="id59"/>
			<label kind="guard" x="85" y="-306">x&gt;=DELAY_DEURBEWEGING</label>
			<label kind="synchronisation" x="85" y="-323">deurGeopend[i]!</label>
			<nail x="68" y="-340"/>
		</transition>
		<transition id="id65">
			<source ref="id58"/>
			<target ref="id60"/>
			<label kind="synchronisation" x="-238" y="-323">openDeur[i]?</label>
			<label kind="assignment" x="-238" y="-306">x=0</label>
			<nail x="-238" y="-340"/>
		</transition>
	</template>
	<system>system sluis, sluisdeur, schipsensor, vaarsein, sluisluik;
</system>
	<queries>
		<query>
			<formula>A[] not deadlock</formula>
			<comment>check for deadlock</comment>
			<result outcome="success" type="quality" timestamp="2024-03-27 14:31:42 +0100">
			</result>
		</query>
		<query>
			<formula>A[] exists(i:sluisdeur_id) sluisdeur(i).gesloten</formula>
			<comment>Er kan nooit een situatie ontstaan waarin niet ten minste één deur is gesloten.</comment>
			<result outcome="success" type="quality" timestamp="2024-03-27 14:20:27 +0100">
			</result>
		</query>
		<query>
			<formula/>
			<comment>Een deur kan nooit gesloten worden, als er een schip in de deuropening ligt.</comment>
		</query>
		<query>
			<formula>A[] (!sluisdeur(HOOG).gesloten imply sluis.waterniveau==HOOG) and (!sluisdeur(LAAG).gesloten imply sluis.waterniveau==LAAG)</formula>
			<comment>Een deur kan nooit geopend worden, als het waterpeil aan beide kanten van de deur ongelijk is.</comment>
			<result outcome="success" type="quality" timestamp="2024-03-27 14:20:29 +0100">
			</result>
		</query>
		<query>
			<formula/>
			<comment>Het invaarsein mag enkel en alleen op groen staan, als de bijbehorende deur geopend is en het uitvaarsein op rood staat.</comment>
		</query>
		<query>
			<formula/>
			<comment>Het uitvaarsein mag enkel en alleen op groen staan, als de bijbehorende deur geopend is en het invaarsein op rood staat.</comment>
		</query>
		<query>
			<formula>A[] (sum (i : vaarsein_id) vaarsein(i).groen) &lt;= 1</formula>
			<comment>Er kan op elk gegeven moment slechts één sein op groen staan.</comment>
			<result outcome="success" type="quality" timestamp="2024-03-27 14:20:31 +0100">
			</result>
		</query>
		<query>
			<formula/>
			<comment>Als er schepen in de sluis liggen, heeft het uitvaarsein altijd voorrang op het invaarsein. Als alle schepen uit de sluis zijn gevaren, gaat het uitvaarsein uit en het invaarsein aan.</comment>
		</query>
		<query>
			<formula/>
			<comment>Als er geen schip in de sluis ligt, dan gaat het uitvaarsein niet aan, maar het invaarsein gaat aan.</comment>
		</query>
		<query>
			<formula/>
			<comment>De sluis wordt maximaal gevuld, tot óf het maximaal aantal schepen in de sluis is bereikt óf er geen wachtende schepen meer zijn die naar binnen kunnen varen.</comment>
		</query>
		<query>
			<formula/>
			<comment>Als het maximaal aantal schepen in de sluis is bereikt of er zijn geen wachtende schepen meer, dan worden de deuren direct gesloten.</comment>
		</query>
		<query>
			<formula/>
			<comment>Nadat de deuren zijn gesloten, duurt het maximaal 1 minuut totdat de sluisluiken geopend worden.</comment>
		</query>
		<query>
			<formula/>
			<comment>Als het niveau aan beide kanten van de deuren gelijk is (na het openen van de luiken), duurt het maximaal 1 minuut tot de deuren geopend worden.</comment>
		</query>
		<query>
			<formula>A[] forall(i: sluisdeur_id) (sluisdeur(i).open --&gt; vaarsein(i).groen)</formula>
			<comment>Als er deuren geopend zijn, duurt het maximaal 1 minuut tot ofwel het invaar- of uitvaarsein aan gaat.</comment>
		</query>
	</queries>
</nta>
