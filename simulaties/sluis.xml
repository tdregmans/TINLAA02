<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.6//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_6.dtd'>
<nta>
	<declaration>
// sluisdeuren
const int AANTAL_SLUISDEUREN = 2;
typedef int[0,AANTAL_SLUISDEUREN - 1] sluisdeur_id;

chan openDeur[sluisdeur_id];
chan sluitDeur[sluisdeur_id];
chan deurGeopend[sluisdeur_id];
chan deurGesloten[sluisdeur_id];

// scheepssensoren
const int AANTAL_SCHEEPSSENSOREN = 2;
typedef int[0,AANTAL_SCHEEPSSENSOREN - 1] schipsensor_id;

chan schipGedetecteerd[schipsensor_id];

// constanten ter verduidelijking
const int LAAG = 0;
const int HOOG = 1;

// constante tijdsduur waterbeweging en deurbeweging
const int DELAY_WATERBEWEGING = 10;
const int DELAY_DEURBEWEGING = 5;</declaration>
	<template>
		<name x="5" y="5">sluis</name>
		<declaration>clock x;

bool reverse = false;</declaration>
		<location id="id0" x="204" y="102">
			<name x="204" y="119">start</name>
			<label kind="comments" x="204" y="144">Alles gesloten,
waterniveau = LAAG
en seinen op rood.</label>
		</location>
		<location id="id1" x="442" y="-136">
			<name x="450" y="-178">deurLaagOpenend</name>
		</location>
		<location id="id2" x="680" y="102">
			<name x="688" y="68">klaarVoorSchipLaag</name>
		</location>
		<location id="id3" x="680" y="340">
			<name x="688" y="306">deurLaagSluitend</name>
		</location>
		<location id="id4" x="680" y="578">
			<name x="680" y="595">klaarVoorBeweging</name>
		</location>
		<location id="id5" x="204" y="578">
			<name x="204" y="595">sluiswaterInBeweging</name>
			<label kind="invariant" x="204" y="612">x&lt;=DELAY_WATERBEWEGING</label>
		</location>
		<location id="id6" x="-272" y="578">
			<name x="-416" y="595">klaarMetBeweging</name>
		</location>
		<location id="id7" x="-272" y="340">
			<name x="-408" y="306">deurHoogOpenend</name>
		</location>
		<location id="id8" x="-272" y="102">
			<name x="-433" y="68">klaarVoorSchipHoog</name>
		</location>
		<location id="id9" x="-34" y="-136">
			<name x="-178" y="-170">deurHoogSluitend</name>
		</location>
		<location id="id10" x="255" y="-17">
			<label kind="invariant" x="246" y="42">x&lt;=0</label>
		</location>
		<location id="id11" x="0" y="102">
			<label kind="invariant" x="17" y="119">x&lt;=0</label>
		</location>
		<init ref="id0"/>
		<transition id="id12">
			<source ref="id0"/>
			<target ref="id10"/>
			<label kind="synchronisation" x="187" y="8">schipGedetecteerd[LAAG]?</label>
			<label kind="assignment" x="246" y="25">x=0</label>
		</transition>
		<transition id="id13">
			<source ref="id0"/>
			<target ref="id11"/>
			<label kind="synchronisation" x="18" y="85">schipGedetecteerd[HOOG]?</label>
			<label kind="assignment" x="18" y="102">x=0</label>
		</transition>
		<transition id="id14">
			<source ref="id5"/>
			<target ref="id4"/>
			<label kind="guard" x="263" y="484">x&gt;=DELAY_WATERBEWEGING &amp;&amp; reverse==true</label>
			<nail x="238" y="510"/>
			<nail x="578" y="510"/>
		</transition>
		<transition id="id15">
			<source ref="id6"/>
			<target ref="id5"/>
			<label kind="guard" x="-34" y="484">reverse==true</label>
			<label kind="assignment" x="-102" y="484">x=0</label>
			<nail x="-170" y="510"/>
			<nail x="170" y="510"/>
		</transition>
		<transition id="id16">
			<source ref="id4"/>
			<target ref="id3"/>
			<label kind="guard" x="493" y="442">reverse==true</label>
			<label kind="synchronisation" x="476" y="425">openDeur[LAAG]!</label>
			<nail x="612" y="476"/>
			<nail x="612" y="374"/>
		</transition>
		<transition id="id17">
			<source ref="id7"/>
			<target ref="id6"/>
			<label kind="guard" x="-195" y="442">reverse==true</label>
			<label kind="synchronisation" x="-195" y="425">deurGesloten[HOOG]?</label>
			<nail x="-204" y="374"/>
			<nail x="-204" y="476"/>
		</transition>
		<transition id="id18">
			<source ref="id3"/>
			<target ref="id2"/>
			<label kind="guard" x="493" y="204">reverse==true</label>
			<label kind="synchronisation" x="450" y="187">deurGeopend[LAAG]?</label>
			<nail x="612" y="306"/>
			<nail x="612" y="136"/>
		</transition>
		<transition id="id19">
			<source ref="id8"/>
			<target ref="id7"/>
			<label kind="guard" x="-195" y="204">reverse==true</label>
			<label kind="synchronisation" x="-195" y="187">sluitDeur[HOOG]!</label>
			<nail x="-204" y="136"/>
			<nail x="-204" y="306"/>
		</transition>
		<transition id="id20">
			<source ref="id2"/>
			<target ref="id1"/>
			<label kind="guard" x="484" y="102">reverse==true</label>
			<label kind="synchronisation" x="484" y="76">sluitDeur[LAAG]!</label>
			<nail x="476" y="102"/>
			<nail x="476" y="-102"/>
		</transition>
		<transition id="id21">
			<source ref="id9"/>
			<target ref="id8"/>
			<label kind="guard" x="-187" y="102">reverse==true</label>
			<label kind="synchronisation" x="-229" y="76">deurGeopend[HOOG]?</label>
			<nail x="-68" y="-102"/>
			<nail x="-68" y="102"/>
		</transition>
		<transition id="id22">
			<source ref="id1"/>
			<target ref="id0"/>
			<label kind="guard" x="289" y="102">reverse==true</label>
			<label kind="synchronisation" x="238" y="76">deurGesloten[LAAG]?</label>
			<nail x="408" y="-102"/>
			<nail x="408" y="102"/>
		</transition>
		<transition id="id23">
			<source ref="id11"/>
			<target ref="id9"/>
			<label kind="synchronisation" x="8" y="-17">openDeur[HOOG]!</label>
			<label kind="assignment" x="8" y="0">reverse=true</label>
			<nail x="0" y="-102"/>
		</transition>
		<transition id="id24">
			<source ref="id9"/>
			<target ref="id0"/>
			<label kind="guard" x="-8" y="-136">reverse==false</label>
			<label kind="synchronisation" x="-8" y="-161">deurGesloten[HOOG]?</label>
			<nail x="102" y="-136"/>
		</transition>
		<transition id="id25">
			<source ref="id8"/>
			<target ref="id9"/>
			<label kind="guard" x="-374" y="-68">reverse==false</label>
			<label kind="synchronisation" x="-391" y="-93">sluitDeur[HOOG]!</label>
			<nail x="-238" y="-136"/>
		</transition>
		<transition id="id26">
			<source ref="id7"/>
			<target ref="id8"/>
			<label kind="guard" x="-399" y="204">reverse==false</label>
			<label kind="synchronisation" x="-433" y="187">deurGeopend[HOOG]?</label>
		</transition>
		<transition id="id27">
			<source ref="id6"/>
			<target ref="id7"/>
			<label kind="guard" x="-399" y="442">reverse==false</label>
			<label kind="synchronisation" x="-408" y="425">openDeur[HOOG]!</label>
		</transition>
		<transition id="id28">
			<source ref="id5"/>
			<target ref="id6"/>
			<label kind="guard" x="-170" y="586">x&gt;=DELAY_WATERBEWEGING &amp;&amp; reverse==false</label>
		</transition>
		<transition id="id29">
			<source ref="id4"/>
			<target ref="id5"/>
			<label kind="guard" x="408" y="578">reverse==false</label>
			<label kind="assignment" x="416" y="552">x=0</label>
		</transition>
		<transition id="id30">
			<source ref="id3"/>
			<target ref="id4"/>
			<label kind="guard" x="688" y="442">reverse==false</label>
			<label kind="synchronisation" x="688" y="425">deurGesloten[LAAG]?</label>
		</transition>
		<transition id="id31">
			<source ref="id2"/>
			<target ref="id3"/>
			<label kind="guard" x="688" y="204">reverse==false</label>
			<label kind="synchronisation" x="688" y="187">sluitDeur[LAAG]!</label>
		</transition>
		<transition id="id32">
			<source ref="id1"/>
			<target ref="id2"/>
			<label kind="guard" x="663" y="-68">reverse==false</label>
			<label kind="synchronisation" x="663" y="-93">deurGeopend[LAAG]?</label>
			<nail x="646" y="-136"/>
		</transition>
		<transition id="id33">
			<source ref="id10"/>
			<target ref="id1"/>
			<label kind="synchronisation" x="306" y="-161">openDeur[LAAG]!</label>
			<label kind="assignment" x="306" y="-136">reverse=false,
x=0</label>
			<nail x="306" y="-136"/>
		</transition>
	</template>
	<template>
		<name>schipsensor</name>
		<parameter>schipsensor_id i</parameter>
		<declaration>clock x;</declaration>
		<location id="id34" x="0" y="0">
			<name x="-59" y="-34">sensor</name>
		</location>
		<init ref="id34"/>
		<transition id="id35">
			<source ref="id34"/>
			<target ref="id34"/>
			<label kind="guard" x="76" y="8">x&gt;=1</label>
			<label kind="synchronisation" x="76" y="-25">schipGedetecteerd[i]!</label>
			<label kind="assignment" x="76" y="-8">x=0</label>
			<nail x="68" y="-68"/>
			<nail x="68" y="68"/>
		</transition>
	</template>
	<template>
		<name>sluisdeur</name>
		<parameter>sluisdeur_id i</parameter>
		<declaration>clock x;</declaration>
		<location id="id36" x="-272" y="-170">
			<name x="-263" y="-204">gesloten</name>
		</location>
		<location id="id37" x="102" y="-170">
			<name x="102" y="-204">open</name>
		</location>
		<location id="id38" x="-68" y="-340">
			<name x="-59" y="-382">aanHetOpenen</name>
			<label kind="invariant" x="-59" y="-365">x&lt;=5</label>
		</location>
		<location id="id39" x="-68" y="0">
			<name x="-59" y="-42">aanHetSluiten</name>
			<label kind="invariant" x="-59" y="-25">x&lt;=5</label>
		</location>
		<init ref="id36"/>
		<transition id="id40">
			<source ref="id39"/>
			<target ref="id36"/>
			<label kind="guard" x="-246" y="-68">x&gt;=5</label>
			<label kind="synchronisation" x="-246" y="-85">deurGesloten[i]!</label>
			<nail x="-238" y="0"/>
		</transition>
		<transition id="id41">
			<source ref="id37"/>
			<target ref="id39"/>
			<label kind="synchronisation" x="93" y="-85">sluitDeur[i]?</label>
			<label kind="assignment" x="93" y="-68">x=0</label>
			<nail x="68" y="0"/>
		</transition>
		<transition id="id42">
			<source ref="id38"/>
			<target ref="id37"/>
			<label kind="guard" x="85" y="-306">x&gt;=5</label>
			<label kind="synchronisation" x="85" y="-323">deurGeopend[i]!</label>
			<nail x="68" y="-340"/>
		</transition>
		<transition id="id43">
			<source ref="id36"/>
			<target ref="id38"/>
			<label kind="synchronisation" x="-238" y="-323">openDeur[i]?</label>
			<label kind="assignment" x="-238" y="-306">x=0</label>
			<nail x="-238" y="-340"/>
		</transition>
	</template>
	<system>system sluis, sluisdeur, schipsensor;
</system>
	<queries>
		<query>
			<formula>A[] not deadlock</formula>
			<comment>check for deadlock</comment>
			<result outcome="failure" type="quality" timestamp="2024-03-26 23:29:42 +0100">
			</result>
		</query>
		<query>
			<formula>A[] exists(i:sluisdeur_id) sluisdeur(i).gesloten</formula>
			<comment>Er kan nooit een situatie ontstaan waarin niet ten minste één deur is gesloten.</comment>
			<result outcome="success" type="quality" timestamp="2024-03-26 21:58:26 +0100">
			</result>
		</query>
		<query>
			<formula/>
			<comment>Een deur kan nooit gesloten worden, als er een schip in de deuropening ligt.</comment>
		</query>
		<query>
			<formula/>
			<comment>Een deur kan nooit geopend worden, als het waterpeil aan beide kanten van de deur ongelijk is.</comment>
		</query>
		<query>
			<formula/>
			<comment>Het invaarsein mag enkel en alleen op groen staan, als de bijbehorende deur geopend is en het uitvaarsein op rood staat.</comment>
		</query>
		<query>
			<formula/>
			<comment>Het uitvaarsein mag enkel en alleen op groen staan, als de bijbehorende deur geopend is en het invaarsein op rood staat.</comment>
		</query>
		<query>
			<formula/>
			<comment>Er kan op elk gegeven moment slechts één sein op groen staan.</comment>
		</query>
		<query>
			<formula/>
			<comment>Als er schepen in de sluis liggen, heeft het uitvaarsein altijd voorrang op het invaarsein. Als alle schepen uit de sluis zijn gevaren, gaat het uitvaarsein uit en het invaarsein aan.</comment>
		</query>
		<query>
			<formula/>
			<comment>Als er geen schip in de sluis ligt, dan gaat het uitvaarsein niet aan, maar het invaarsein gaat aan.</comment>
		</query>
		<query>
			<formula/>
			<comment>De sluis wordt maximaal gevuld, tot óf het maximaal aantal schepen in de sluis is bereikt óf er geen wachtende schepen meer zijn die naar binnen kunnen varen.</comment>
		</query>
		<query>
			<formula/>
			<comment>Als het maximaal aantal schepen in de sluis is bereikt of er zijn geen wachtende schepen meer, dan worden de deuren direct gesloten.</comment>
		</query>
		<query>
			<formula/>
			<comment>Nadat de deuren zijn gesloten, duurt het maximaal 1 minuut totdat de sluisluiken geopend worden.</comment>
		</query>
		<query>
			<formula/>
			<comment>Als het niveau aan beide kanten van de deuren gelijk is (na het openen van de luiken), duurt het maximaal 1 minuut tot de deuren geopend worden.</comment>
		</query>
		<query>
			<formula/>
			<comment>Als er deuren geopend zijn, duurt het maximaal 1 minuut tot ofwel het invaar- of uitvaarsein aan gaat.</comment>
		</query>
	</queries>
</nta>
